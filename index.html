<!DOCTYPE html>
<html lang="zh-CN">
    <!--
    Copyright (c) HikiMuæ…•é±¼é…± All rights reserved.
    Version: 25.11.02 (githubç‰ˆæœ¬ 1.2)
    -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ç”µæ± å®¹é‡è®¡ç®—å™¨</title>
        <meta name="description" content="ç”µæ± å®¹é‡è®¡ç®—å™¨æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºä»å¯¼å‡ºçš„ZIPæ–‡ä»¶ä¸­æå–ç”µæ± å®¹é‡ä¿¡æ¯ï¼Œå¹¶è®¡ç®—å½“å‰ç”µæ± å®¹é‡çš„ç™¾åˆ†æ¯”">
        <meta name="keywords"
            content="ç”µæ± å®¹é‡è®¡ç®—å™¨, ZIPæ–‡ä»¶å¤„ç†, ç”µæ± å¥åº·åº¦, ç”µæ± å®¹é‡ç™¾åˆ†æ¯”, zip.jsåº“, HyperOSç”µæ± å®¹é‡, MIUIç”µæ± å®¹é‡, ç”µæ± å®¹é‡æå–å·¥å…·, ç”µæ± å¥åº·åº¦æ£€æµ‹">
        <style>
            body {
                font-family: 'Arial', 'sans-serif', 'Misans';
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f8f9fa;
                color: #2d3748;
            }

            .container {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                padding: 25px;
                border-radius: 12px;
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
                margin-bottom: 20px;
                border: 1px solid #e2e8f0;
            }

            h1 {
                color: #2b6cb0;
                text-align: center;
                margin-bottom: 25px;
                font-weight: 600;
                font-size: 28px;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            }

            .instructions {
                margin-bottom: 25px;
                padding: 18px;
                background: linear-gradient(135deg, #ebf8ff 0%, #e6fffa 100%);
                border-radius: 8px;
                border-left: 5px solid #4299e1;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
            }

            /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
            .file-upload {
                margin-bottom: 25px;
            }

            .file-upload input {
                display: block;
                width: 95%;
                padding: 14px;
                margin-top: 8px;
                border: 2px dashed #cbd5e0;
                border-radius: 6px;
                background-color: #f7fafc;
                transition: all 0.3s ease;
            }

            .file-upload input:hover {
                border-color: #4299e1;
                background-color: #edf2f7;
            }

            /* è¾“å…¥åŒºåŸŸ */
            .input-group {
                margin-bottom: 25px;
            }

            .input-group label {
                display: block;
                margin-bottom: 10px;
                font-weight: 600;
                color: #2d3748;
                font-size: 15px;
            }

            .input-group input {
                width: 100%;
                padding: 14px;
                box-sizing: border-box;
                border: 2px solid #e2e8f0;
                border-radius: 6px;
                background-color: #ffffff;
                transition: all 0.3s ease;
                font-size: 15px;
            }

            .input-group input:focus {
                border-color: #4299e1;
                box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
                outline: none;
            }

            button {
                background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
                color: white;
                border: none;
                padding: 14px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 16px;
                font-weight: 600;
                width: 100%;
                transition: all 0.3s ease;
                box-shadow: 0 2px 4px rgba(72, 187, 120, 0.2);
            }

            button:hover {
                background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
                box-shadow: 0 4px 8px rgba(72, 187, 120, 0.3);
                transform: translateY(-1px);
            }

            .status {
                margin-top: 20px;
                padding: 16px;
                background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);
                border-radius: 8px;
                display: none;
                border-left: 5px solid #4299e1;
                color: #2d3748;
                font-weight: 500;
            }

            .result {
                margin-top: 25px;
                padding: 20px;
                border-radius: 8px;
                display: none;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            }

            .success {
                background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
                color: #22543d;
                border-left: 5px solid #48bb78;
            }

            .error {
                background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
                color: #742a2a;
                border-left: 5px solid #f56565;
            }

            .result-header {
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 2px solid #e2e8f0;
            }

            .result-content {
                margin-bottom: 18px;
            }

            .result-content pre {
                background-color: #f7fafc;
                padding: 12px;
                border-radius: 6px;
                font-family: 'Cascadia Code', 'Courier New', monospace;
                white-space: pre-wrap;
                overflow-wrap: break-word;
                border: 1px solid #e2e8f0;
            }

            .toggle-btn {
                background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
                color: white;
                border: none;
                padding: 10px 18px;
                border-radius: 6px;
                cursor: pointer;
                margin-top: 12px;
                display: inline-block;
                font-weight: 500;
                transition: all 0.3s ease;
                box-shadow: 0 2px 4px rgba(66, 153, 225, 0.2);
            }

            .toggle-btn:hover {
                background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%);
                box-shadow: 0 4px 8px rgba(66, 153, 225, 0.3);
                transform: translateY(-1px);
            }

            .original-text {
                display: none;
                margin-top: 12px;
                padding: 20px;
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                border-radius: 8px;
                white-space: pre-wrap;
                overflow-wrap: break-word;
                border: 1px solid #e2e8f0;
                font-family: 'Cascadia Code', 'Courier New', monospace;
                font-size: 13px;
                line-height: 1.6;
                color: #334155;
                box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
                max-height: 500px;
                overflow-y: auto;
                tab-size: 4;
                -moz-tab-size: 4;
            }

            .original-text .battery-key {
                color: #dc2626;
                font-weight: 600;
                background-color: #fef2f2;
                padding: 1px 4px;
                border-radius: 3px;
            }

            .original-text .capacity-value {
                color: #059669;
                font-weight: 600;
                background-color: #f0fdf4;
                padding: 1px 4px;
                border-radius: 3px;
            }

            .original-text .time-value {
                color: #7c3aed;
                font-weight: 500;
                background-color: #faf5ff;
                padding: 1px 4px;
                border-radius: 3px;
            }

            .original-text .section-title {
                text-align: left;
                font-weight: 700;
                font-size: 15px;
                color: #1e293b;
                margin: 20px 0 12px 0;
                padding-bottom: 8px;
                border-bottom: 2px solid #e2e8f0;
                font-family: 'Arial', 'sans-serif', 'Misans';
            }

            .original-text .section-title:first-child {
                margin-top: 0;
            }

            .original-text .content-block {
                margin-bottom: 20px;
                text-align: left;
            }

            .original-text .content-block pre {
                text-align: left;
                margin: 0;
                padding: 0;
                background: transparent;
                border: none;
                font-family: 'Cascadia Code', 'Courier New', monospace;
            }


            .original-text::-webkit-scrollbar {
                width: 8px;
            }

            .original-text::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 4px;
            }

            .original-text::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 4px;
            }

            .original-text::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
            }

            .footer {
                text-align: center;
                margin-top: 25px;
                font-size: 14px;
                color: #718096;
            }

            .footer a {
                color: #4299e1;
                text-decoration: none;
                font-weight: 500;
                transition: color 0.3s ease;
            }

            .footer a:hover {
                color: #3182ce;
                text-decoration: underline;
            }

            /* å¼€æºé“¾æ¥ */
            .open-source-links {
                margin-top: 12px;
                display: flex;
                justify-content: center;
                gap: 12px;
            }

            .open-source-links span {
                color: #a0aec0;
            }

            .open-source-links a {
                color: #4a5568;
                text-decoration: none;
                font-weight: 500;
                transition: color 0.3s ease;
                font-family: 'Cascadia Code', 'Arial', sans-serif;
            }

            .open-source-links a:hover {
                color: #2d3748;
                text-decoration: underline;
            }


            .media-alert {
                margin-top: 25px;
                padding: 20px;
                background: linear-gradient(135deg, #fffaf0 0%, #feebc8 100%);
                border-radius: 8px;
                border-left: 5px solid #ed8936;
            }

            .media-alert h2 {
                color: #744210;
                margin-bottom: 12px;
            }

            .media-alert p {
                color: #744210;
                line-height: 1.6;
            }

            .media-highlight {
                background-color: #fed7d7;
                padding: 2px 6px;
                border-radius: 3px;
                font-weight: 600;
            }

            code,
            .english-text {
                font-family: 'Cascadia Code', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            }
        </style>
    </head>

<body>
    <div id="watermark-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 9999; overflow: hidden;"></div>
    <div class="container">
        <h1>ç”µæ± å®¹é‡è®¡ç®—å™¨</h1>

        <div class="instructions">
            <p><strong>å…³äºæœ¬å·¥å…·ï¼š</strong> æå–ZIPæ–‡ä»¶ä¸­çš„ç”µæ± æ•°æ®ï¼Œå¹¶è®¡ç®—å½“å‰å®¹é‡ç™¾åˆ†æ¯”ã€‚</p>
            <p><strong>ä½¿ç”¨è¯´æ˜ï¼š</strong> è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼Œä»¥è·å–å‡†ç¡®çš„ç”µæ± å®¹é‡ç™¾åˆ†æ¯”ã€‚</p>
            <p><strong style="color:red">âš ï¸æ³¨æ„: æ‰€æœ‰åˆ†æè¿‡ç¨‹å‡åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ è‡³ä»»ä½•æœåŠ¡å™¨ï¼Œç¡®ä¿æ‚¨çš„ä¿¡æ¯å®‰å…¨</strong>
                (æ²¡æœ‰èµ„æœ¬å»å¯¹debugåŒ…è¿›è¡Œæ·±å…¥ç ”ç©¶)</p>
            <p><strong style="color:red">âš ï¸å…è´£å£°æ˜: è‹¥è®¾å¤‡å‡ºç°å¼‚å¸¸ï¼Œè¯·å‰å¾€å°ç±³å®˜æ–¹å”®åã€‚<br>æœ¬å·¥å…·ä»…é€šè¿‡è§£æç³»ç»Ÿè¯Šæ–­æ–‡ä»¶ä¼°ç®—ç”µæ± å®¹é‡ï¼Œç»“æœä»…ä¾›å‚è€ƒï¼Œä¸å…·å¤‡å®˜æ–¹æ£€æµ‹æ•ˆåŠ›ã€‚</strong>
            </p>
        </div>

        <div class="instructions">
            <p>æ®è¯´å…ˆæŠŠç”µé‡å……åˆ° 100% å†ç»§ç»­å…… 30 åˆ†é’Ÿæ›´å‡†ä¸€äº›å“¦~</p>
            <p><strong>æ­¥éª¤ 1ï¼š </strong>è¯·è¿ç»­ç‚¹å‡»â€œè®¾ç½® > å…¨éƒ¨å‚æ•°ä¸ä¿¡æ¯ > å¤„ç†å™¨(è¿ç»­ç‚¹å‡»)â€</p>
            <p><strong>æˆ–ï¼š </strong>è¿ç»­æŒ‰éŸ³é‡åŠ å‡é”®ï¼Œç›´è‡³å‡ºç°æç¤º</p>
            <p><strong>æˆ–ï¼š </strong>ä½¿ç”¨ä¸‹æ–¹ä¸€é”®æŠ“åŒ…æŒ‰é’®ï¼Œæ‰‹åŠ¨è¾“å…¥*å¼€å§‹æŠ“åŒ…</p>
            <p><strong>æ­¥éª¤ 2ï¼š</strong> ç¨ç­‰ç‰‡åˆ»åï¼Œå°†ç³»ç»Ÿå¯¼å‡ºçš„ZIPæ–‡ä»¶ä¸Šä¼ è‡³æœ¬å·¥å…·</p>
            <p><strong>æ­¥éª¤ 3ï¼š</strong> è¾“å…¥æ‚¨çš„HyperOS/MIUIè®¾å¤‡çš„åˆå§‹ç”µæ± å®¹é‡</p>
            <p><strong>æ­¥éª¤ 4ï¼š</strong> ç‚¹å‡»â€œè®¡ç®—â€æŒ‰é’®ï¼Œè·å–å½“å‰ç”µæ± å®¹é‡çš„ç™¾åˆ†æ¯”</p>
            <iframe
                src="//player.bilibili.com/player.html?isOutside=true&aid=114260860472968&bvid=BV13YZ4YEE8B&cid=29177544707&p=1"
                scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%">
            </iframe>
        </div>

        <div class="file-upload">
            <label for="zip-file">é€‰æ‹©ZIPæ–‡ä»¶:</label>
            <input type="file" id="zip-file" accept=".zip" required>
        </div>

        <div class="input-group">
            <label for="initial-capacity">è¯·è¾“å…¥æ‚¨çš„HyperOS/MIUIè®¾å¤‡çš„åˆå§‹ç”µæ± å®¹é‡ (mAh):</label>
            <input type="number" id="initial-capacity" placeholder="ä¾‹å¦‚: 5000" required>
        </div>
        <!-- ä¸€é”®æŠ“åŒ…æŒ‰é’® -->
        <a href="tel:*%23*%23284%23*%23" target="_top" style="text-decoration: none;">
            <button style="
            background-color: #3498db;
            margin-bottom: 10px;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
          ">
                ğŸ”§ ä¸€é”®æŠ“åŒ…
            </button>
        </a>
        <p style="color:red;">(æ‹¨å·ç•Œé¢ä¸­è¾“å…¥" * "ä»¥å¼€å§‹æŠ“åŒ…)</p>
        <button id="calculate-btn">è®¡ç®—</button>

        <div id="status" class="status"></div>
        <div id="result" class="result"></div>
        <!--<div class="media-alert">
            <h2>è‡´åª’ä½“æœ‹å‹çš„é‡è¦æç¤º</h2>
            <p>å°Šæ•¬çš„åª’ä½“å·¥ä½œè€…ï¼Œåœ¨æŠ¥é“æœ¬å·¥å…·æ—¶ï¼Œè¯·åŠ¡å¿…å®Œæ•´å‘ˆç°ä¸Šè¿°<span
                    class="media-highlight">çº¢å­—å…³é”®ä¿¡æ¯</span>ï¼Œé¿å…å¯¹ç”¨æˆ·é€ æˆè¯¯å¯¼<br>è¯·åŠ¡å¿…åœ¨ä½ æ‰€å‘å¸ƒçš„è§†é¢‘æˆ–è½¯ä»¶å¹³å°å£°æ˜åˆ›ä½œè€…ã€‚<br>è‹¥äº§ç”Ÿåˆ›ä½œæ”¶ç›Š(æŒ‰ç…§æ”¶ç›Šçš„5%åˆ†å‘ç»™ä½œè€…)<br><br>
                æ„Ÿè°¢åª’ä½“æœ‹å‹å¯¹æœ¬å·¥å…·çš„å®¢è§‚æŠ¥é“ï¼</p>
        </div>-->
    </div>

    <div class="footer">
        <p>è§‰å¾—å¥½ç”¨ç‚¹é“¾æ¥æ”¯æŒä¸‹å‘—ï½<a href="http://119.29.227.6/pay">ã€é“¾æ¥ã€‘</a></p>
        <div class="open-source-links">
            <a href="https://github.com/gildas-lormeau/zip.js">å¼€æºå·¥å…·è®¸å¯</a>
            <span>|</span>
            <a href="https://github.com/Hikimucheno/HyperBatteryHealthCalc">æ­¤é¡¹ç›®å¼€æºåœ°å€</a>
        </div>
        <p>Copyright Â© HikiMuæ…•é±¼é…± All rights reserved. | å°ç±³ç”µæ± å®¹é‡è®¡ç®—å™¨</p>
    </div>

    <script src="js/zip.min.js"></script>
    <script src="js/zip.js"></script>
    <script>
        document.getElementById('calculate-btn').addEventListener('click', function () {
            const fileInput = document.getElementById('zip-file');
            const initialCapacityInput = document.getElementById('initial-capacity');
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');

            if (!fileInput.files || fileInput.files.length === 0) {
                showError(resultDiv, "è¯·é€‰æ‹©ä¸€ä¸ªZIPæ–‡ä»¶");
                return;
            }

            const initialCapacity = parseFloat(initialCapacityInput.value);
            if (isNaN(initialCapacity) || initialCapacity <= 0) {
                showError(resultDiv, "è¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„åˆå§‹ç”µæ± å®¹é‡");
                return;
            }

            const file = fileInput.files[0];
            showStatus(statusDiv, "æ­£åœ¨è§£æç”µæ± æ•°æ®ï¼Œè¯·ç¨å€™...");
            processZipFile(file, initialCapacity, statusDiv, resultDiv);
        });

        async function processZipFile(file, initialCapacity, statusDiv, resultDiv) {
            try {
                const reader = new zip.ZipReader(new zip.BlobReader(file));
                showStatus(statusDiv, "æ­£åœ¨è§£å‹å¤–å±‚ZIPæ–‡ä»¶...");
                const entries = await reader.getEntries();

                for (const entry of entries) {
                    if (entry.filename.endsWith('.zip')) {
                        showStatus(statusDiv, "æ­£åœ¨è§£å‹å†…å±‚ZIPæ–‡ä»¶...");
                        const innerZipBlob = await entry.getData(new zip.BlobWriter('application/zip'));
                        const innerReader = new zip.ZipReader(new zip.BlobReader(innerZipBlob));
                        showStatus(statusDiv, "æ­£åœ¨æŸ¥æ‰¾åŒ…å«ç”µæ± å®¹é‡ä¿¡æ¯çš„æ–‡ä»¶...");
                        const innerEntries = await innerReader.getEntries();

                        for (const innerEntry of innerEntries) {
                            if (innerEntry.filename.includes('bugreport') && innerEntry.filename.endsWith('.txt')) {
                                showStatus(statusDiv, "æ­£åœ¨æå–ç”µæ± å®¹é‡ä¿¡æ¯...");
                                const content = await innerEntry.getData(new zip.TextWriter());
                                const batteryInfo = extractBatteryCapacity(content);
                                const statistics = extractStatistics(content);

                                if (batteryInfo.minLearned !== null && batteryInfo.minLearned !== undefined) {
                                    showStatus(statusDiv, "æ­£åœ¨è®¡ç®—ç”µæ± å®¹é‡ç™¾åˆ†æ¯”...");
                                    const percentage = (batteryInfo.minLearned / initialCapacity) * 100;
                                    const rating = getBatteryRating(percentage);

                                    // æ„å»ºè¯¦ç»†çš„ç»“æœä¿¡æ¯
                                    let resultMessage = `
                                <div class="result-header">
                                    <h3>ğŸ”‹ ç”µæ± å®¹é‡è¯¦ç»†æŠ¥å‘Š</h3>
                                </div>
                                <div class="result-content">
                                    <p><strong>ğŸ“Š åŸºæœ¬ä¿¡æ¯</strong></p>
                                    <p>åŸå§‹è®¾è®¡å®¹é‡: <strong>${initialCapacity} mAh</strong></p>
                                    <p>å½“å‰å®é™…å®¹é‡: <strong>${batteryInfo.minLearned} mAh</strong></p>
                                    <p>ç”µæ± å¥åº·åº¦: <strong>${percentage.toFixed(2)}%</strong> <span style="margin-left: 10px; font-size: 0.9em; color: ${getRatingColor(percentage)}">(${rating})</span></p>
                            `;

                                    // ç”µæ± ç¡¬ä»¶ä¿¡æ¯
                                    resultMessage += `
                                <p><strong>ğŸ”§ ç”µæ± ç¡¬ä»¶ä¿¡æ¯</strong></p>
                            `;

                                    if (batteryInfo.estimated) {
                                        resultMessage += `<p>ä¼°ç®—æ»¡å……å®¹é‡: <strong>${batteryInfo.estimated} mAh</strong></p>`;
                                    }
                                    if (batteryInfo.lastLearned) {
                                        resultMessage += `<p>ä¸Šæ¬¡å­¦ä¹ å®¹é‡: <strong>${batteryInfo.lastLearned} mAh</strong></p>`;
                                    }
                                    if (batteryInfo.minLearned) {
                                        resultMessage += `<p>æœ€å°å­¦ä¹ å®¹é‡: <strong>${batteryInfo.minLearned} mAh</strong> </p>`;
                                    }
                                    if (batteryInfo.maxLearned) {
                                        resultMessage += `<p>æœ€å¤§å­¦ä¹ å®¹é‡: <strong>${batteryInfo.maxLearned} mAh</strong></p>`;
                                    }
                                    if (batteryInfo.cycleCount) {
                                        resultMessage += `<p>å……ç”µå¾ªç¯æ¬¡æ•°: <strong>${batteryInfo.cycleCount} æ¬¡</strong></p>`;
                                        resultMessage += `<p style="font-size: 0.9em; color: #666;">ğŸ’¡ æ»¡å……å®¹é‡ä¼šéšç€å¾ªç¯æ¬¡æ•°çš„å¢åŠ è€Œé€æ¸å‡å°‘</p>`;
                                    } else {
                                        resultMessage += `<p>å……ç”µå¾ªç¯æ¬¡æ•°: <strong>æœªæ£€æµ‹åˆ°</strong> (ä¸åŒæœºå‹æ•°æ®æœ‰å·®å¼‚)</p>`;
                                    }

                                    resultMessage += `
                                </div>
                                <div class="result-content">
                                    <p class="footer">ä¸ªäººå¼€å‘çš„å°å·¥å…·ï¼Œç”¨çš„äººå˜å¤šäº†ï¼Œæ¯æœˆ 50 å…ƒæœåŠ¡å™¨è´¹æœ‰ç‚¹æ‰›ä¸ä½äº†... è§‰å¾—å¥½ç”¨ç‚¹é“¾æ¥æ”¯æŒä¸‹å‘—ï½<a href="http://119.29.227.6/pay">ã€é“¾æ¥ã€‘</a></p>
                                </div>
                            `;

                                    // åŸæ–‡æ˜¾ç¤ºåŠŸèƒ½
                                    if (statistics && Object.keys(statistics).length > 0) {
                                        const originalTextId = 'original-text-' + Date.now();
                                        const batteryTranslatedText = translateBatteryInfoOnly(statistics.original);

                                        resultMessage += `
        <div class="result-header">
            <button class="toggle-btn" onclick="toggleOriginalText(this)">ğŸ“– æ˜¾ç¤ºç”µæ± è¯¦ç»†ä¿¡æ¯</button>
            <div class="original-text" id="${originalTextId}">
                <div class="content-block">
                    <div class="section-title">ğŸ” ç”µæ± å…³é”®ä¿¡æ¯ç¿»è¯‘</div>
                    <div style="background: #f0f8ff; padding: 12px; border-radius: 6px; margin-top: 8px;">
                        ${batteryTranslatedText}
                    </div>
                </div>
                <div class="content-block">
                    <div class="section-title">ğŸ“„ åŸå§‹ç”µæ± æ•°æ®</div>
                    <pre style="background: #f5f5f5; padding: 12px; border-radius: 6px; margin-top: 8px; max-height: 300px; overflow-y: auto;">${statistics.original}</pre>
                </div>
            </div>
        </div>
    `;
                                    }

                                    showResult(resultDiv, resultMessage, true);
                                    await reader.close();
                                    await innerReader.close();
                                    return;
                                }
                            }
                        }
                        await innerReader.close();
                    }
                }

                showError(resultDiv, "æ— æ³•ä»ZIPæ–‡ä»¶ä¸­æ‰¾åˆ°æˆ–æå–ç”µæ± å®¹é‡");
                await reader.close();
            } catch (error) {
                console.error("Error processing ZIP file:", error);
                showError(resultDiv, "å¤„ç†ZIPæ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®");
            } finally {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 1000);
            }
        }

        // ç”µæ± å®¹é‡æå–
        function extractBatteryCapacity(text) {
            const batteryInfo = {};

            // æå–å„ç§ç”µæ± å®¹é‡ä¿¡æ¯
            const estimatedMatch = text.match(/Estimated battery capacity:\s*([\d.]+)\s*mAh/);
            const lastLearnedMatch = text.match(/Last learned battery capacity:\s*(\d+)\s*mAh/);
            const minLearnedMatch = text.match(/Min learned battery capacity:\s*(\d+)\s*mAh/);
            const maxLearnedMatch = text.match(/Max learned battery capacity:\s*(\d+)\s*mAh/);

            // å°è¯•æå–å¾ªç¯æ¬¡æ•°ï¼ˆä¸åŒæœºå‹å¯èƒ½å­—æ®µä¸åŒï¼‰
            const cycleMatch1 = text.match(/Cycle count:\s*(\d+)/i);
            const cycleMatch2 = text.match(/charge cycle:\s*(\d+)/i);
            const cycleMatch3 = text.match(/å¾ªç¯æ¬¡æ•°:\s*(\d+)/i);
            const cycleMatch4 = text.match(/battery cycle count:\s*(\d+)/i);

            if (estimatedMatch) batteryInfo.estimated = parseFloat(estimatedMatch[1]);
            if (lastLearnedMatch) batteryInfo.lastLearned = parseInt(lastLearnedMatch[1]);
            if (minLearnedMatch) batteryInfo.minLearned = parseInt(minLearnedMatch[1]);
            if (maxLearnedMatch) batteryInfo.maxLearned = parseInt(maxLearnedMatch[1]);

            // ä¼˜å…ˆä½¿ç”¨æ‰¾åˆ°çš„å¾ªç¯æ¬¡æ•°
            if (cycleMatch1) batteryInfo.cycleCount = parseInt(cycleMatch1[1]);
            else if (cycleMatch2) batteryInfo.cycleCount = parseInt(cycleMatch2[1]);
            else if (cycleMatch3) batteryInfo.cycleCount = parseInt(cycleMatch3[1]);
            else if (cycleMatch4) batteryInfo.cycleCount = parseInt(cycleMatch4[1]);

            return batteryInfo;
        }

        function translateBatteryInfoOnly(originalText) {
            const batteryTranslations = {
                // æ ¸å¿ƒç”µæ± å®¹é‡ä¿¡æ¯
                'Estimated battery capacity': 'ä¼°ç®—ç”µæ± å®¹é‡',
                'Last learned battery capacity': 'ä¸Šæ¬¡å­¦ä¹ ç”µæ± å®¹é‡',
                'Min learned battery capacity': 'æœ€å°å­¦ä¹ ç”µæ± å®¹é‡',
                'Max learned battery capacity': 'æœ€å¤§å­¦ä¹ ç”µæ± å®¹é‡',

                // ç³»ç»Ÿç”µæ± çŠ¶æ€
                'System starts': 'ç³»ç»Ÿå¯åŠ¨æ¬¡æ•°',
                'currently on battery': 'å½“å‰ä½¿ç”¨ç”µæ± ä¾›ç”µ',

                // æ—¶é—´ç»Ÿè®¡ï¼ˆä»…ç”µæ± ç›¸å…³ï¼‰
                'Time on battery': 'ç”µæ± ä½¿ç”¨æ€»æ—¶é—´',
                'Charge time remaining': 'å‰©ä½™å……ç”µæ—¶é—´',

                // æ”¾ç”µç»Ÿè®¡
                'Discharge': 'æ€»æ”¾ç”µé‡',
                'Screen off discharge': 'æ¯å±æ”¾ç”µé‡',
                'Screen doze discharge': 'ä¼‘çœ æ”¾ç”µé‡',
                'Screen on discharge': 'äº®å±æ”¾ç”µé‡',
                'Device light doze discharge': 'è®¾å¤‡è½»åº¦ä¼‘çœ æ”¾ç”µ',
                'Device deep doze discharge': 'è®¾å¤‡æ·±åº¦ä¼‘çœ æ”¾ç”µ',

                // ç»Ÿè®¡æ ‡é¢˜
                'Statistics since last charge': 'è‡ªä¸Šæ¬¡å……ç”µä»¥æ¥çš„ç»Ÿè®¡'
            };

            let translatedText = originalText;

            // é¦–å…ˆä¸ºå…³é”®æ•°å€¼æ·»åŠ é«˜äº®
            translatedText = translatedText.replace(/(\d+\.?\d*\s*mAh)/g, '<span class="capacity-value">$1</span>');
            translatedText = translatedText.replace(/(\d+h\s*\d+m\s*\d+s)/g, '<span class="time-value">$1</span>');
            translatedText = translatedText.replace(/(\d{4}-\d{2}-\d{2}-\d{2}-\d{2}-\d{2})/g, '<span class="time-value">$1</span>');

            // ç„¶åæ›¿æ¢å…³é”®æœ¯è¯­
            Object.keys(batteryTranslations).forEach(english => {
                const chinese = batteryTranslations[english];
                const regex = new RegExp(english, 'g');
                translatedText = translatedText.replace(regex, `<span class="battery-key">${english}</span>\n    (${chinese})`);
            });

            return translatedText;
        }

        // æå–ç»Ÿè®¡ä¿¡æ¯å‡½æ•°
        function extractStatistics(text) {
            const startMatch = text.match(/Statistics since last charge:\s*(?:\n|\r|.)*?(?=\n\n|$)/);
            if (!startMatch) return null;

            const statisticsText = startMatch[0];
            const lines = statisticsText.split('\n').filter(line => line.trim() !== '');

            const result = {};
            lines.forEach(line => {
                const parts = line.split(':');
                if (parts.length >= 2) {
                    const key = parts[0].trim();
                    const value = parts.slice(1).join(':').trim();
                    result[key] = value;
                }
            });

            // åŸå§‹æ–‡æœ¬
            result.original = statisticsText;

            return result;
        }

        // è¯„çº§é¢œè‰²å‡½æ•°
        function getRatingColor(percentage) {
            if (percentage > 100) return '#ff6b35';
            else if (percentage >= 90) return '#2ecc71';
            else if (percentage >= 80) return '#f39c12';
            else if (percentage >= 70) return '#e67e22';
            else return '#e74c3c';
        }

        // ç”µæ± è¯„çº§å‡½æ•°
        function getBatteryRating(percentage) {
            if (percentage > 100) {
                return "ğŸ”‹ è¶…å‡ºè®¾è®¡å®¹é‡ï¼ˆå¯èƒ½ä¸ºå†—ä½™è®¾è®¡æˆ–ç¬¬ä¸‰æ–¹ç”µæ± ï¼‰";
            } else if (percentage >= 90) {
                return "âœ… æä½³çŠ¶æ€";
            } else if (percentage >= 80) {
                return "ğŸ‘ è‰¯å¥½çŠ¶æ€";
            } else if (percentage >= 70) {
                return "âš ï¸ æ­£å¸¸è¡°å‡";
            } else {
                return "âŒ å»ºè®®è€ƒè™‘æ›´æ¢ç”µæ± ";
            }
        }

        // æ˜¾ç¤ºç»“æœå‡½æ•°
        function showResult(element, message, isSuccess) {
            element.innerHTML = message;
            element.className = isSuccess ? 'result success' : 'result error';
            element.style.display = 'block';
        }

        // æ˜¾ç¤ºé”™è¯¯å‡½æ•°
        function showError(element, message) {
            showResult(element, message, false);
        }

        // æ˜¾ç¤ºçŠ¶æ€å‡½æ•°
        function showStatus(element, message) {
            element.textContent = message;
            element.style.display = 'block';
        }

        // åˆ‡æ¢åŸæ–‡æ˜¾ç¤ºå‡½æ•°
        function toggleOriginalText(button) {
            const originalTextDiv = button.nextElementSibling;
            if (originalTextDiv.style.display === 'block') {
                originalTextDiv.style.display = 'none';
                button.textContent = 'ğŸ“– æ˜¾ç¤ºç”µæ± è¯¦ç»†ä¿¡æ¯';
            } else {
                originalTextDiv.style.display = 'block';
                button.textContent = 'ğŸ“– éšè—ç”µæ± è¯¦ç»†ä¿¡æ¯';
            }
        }
    </script>
</body>

</html>
